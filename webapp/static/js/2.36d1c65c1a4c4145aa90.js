webpackJsonp([2],{"4erH":function(t,i){},"7Vqv":function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=e("mvHQ"),a=e.n(s),n=e("BO1k"),o=e.n(n),u=e("Dd8w"),r=e.n(u),d=e("vLgD");var l=e("fUgm"),c=e("cA94"),h=e("KFy/"),p={name:"question",data:function(){return{loading:!1,tipsData:{},dialogTips:!1,completeQuestionnaire:!1,data:[],medicalRecordId:"",patientId:"",problemData:[],questionNum:0,questionLength:0}},watch:{scaleId:function(t,i){this.handleChangeJSON()}},mounted:function(){console.log(this.info),0==this.info.examinationStatus||10==this.info.examinationStatus?(this.medicalRecordId=this.info.id,this.patientId=this.info.patientId,this.handleChangeJSON()):this.$router.push("/history")},computed:r()({},Object(l.b)(["info"]),{percentage:function(){var t=Math.ceil((this.questionNum+1)/this.questionLength*100);return t>100&&(t=100),t}}),methods:{onClickLeft:function(){this.$router.go(-1)},finishCommit:function(){var t=this;if(this.completeQuestionnaire){this.hrvComplete;var i={id:this.medicalRecordId,examinationStatus:100};this.loading=!0,Object(h.b)(i).then(function(i){t.loading=!1,200==i.code&&t.$router.push({path:"/home",query:{id:t.medicalRecordId}})})}else this.$toast("筛查问卷还没有做完")},handleChangeJSON:function(){var t,i=this;this.loading=!0,(t={medicalRecordId:this.info.id,questionnaireId:this.info.questionnaireNo},Object(d.a)({url:"ips/questionnaire/details/",method:"get",params:t})).then(function(t){if(i.loading=!1,200==t.code){var e=t.dataList[0],s=!0,a=!1,n=void 0;try{for(var u,r=o()(e.questionList);!(s=(u=r.next()).done);s=!0){var d=u.value;d.question=JSON.parse(d.question)}}catch(t){a=!0,n=t}finally{try{!s&&r.return&&r.return()}finally{if(a)throw n}}i.data=e,i.problemData=i.data.questionList[i.questionNum],i.questionLength=i.data.questionList.length}})},getPatientData:function(){var t=this;this.loading=!0,Object(c.b)(this.medicalRecordId).then(function(i){t.loading=!1,200==i.code&&(t.completeQuestionnaire=i.dataList[0].completeQuestionnaire)})},handleChange:function(t){var i=this;setTimeout(function(){i.nextQuestion()},500)},checkAddShow:function(t){this.problemData.hidden&&(this.questionNum++,this.problemData=t.problem[this.questionNum],this.checkAddShow(t))},checkReduceShow:function(t){this.problemData.hidden&&(this.questionNum--,this.problemData=t.problem[this.questionNum],this.checkReduceShow(t))},formatPercentage:function(){return((this.questionNum+1)/this.questionLength*100).toFixed()+"%"},prevQuestion:function(){if(this.questionNum<=0)this.$toast("当前是第一题");else if(0!=this.problemData.preQuestionNum){for(var t=0;t<this.data.questionList.length;t++)if(this.problemData.preQuestionNum==this.data.questionList[t].preQuestionNum){this.questionNum=t;break}this.questionNum=this.problemData.preQuestionNum,this.problemData=this.data.questionList[this.questionNum]}else this.questionNum--,this.problemData=this.data.questionList[this.questionNum]},nextQuestion:function(){if(this.questionNum<this.questionLength-1)if(""===this.problemData.question.answer)this.$toast("请选择答案");else if(0!=this.problemData.nextQuestionNum&&0==this.problemData.question.answer){for(var t=this.questionNum;t<this.data.questionList.length;t++)if(this.data.questionList[t].question.answer=0,this.problemData.nextQuestionNum==this.data.questionList[t].questionNum){this.questionNum=t;break}this.problemData=this.data.questionList[this.questionNum]}else this.questionNum++,this.problemData=this.data.questionList[this.questionNum];else this.$toast("最后一题了")},appendQuestionSubmitData:function(){var t,i=this,e={questionAnswer:{answer:a()(this.tipsData.question),medicalRecordId:this.medicalRecordId,questionNum:this.tipsData.questionNum,questionnaireId:this.info.questionnaireNo,userId:this.patientId},scaleQuestionResult:{displayOrder:this.tipsData.displayOrder,optionOrderList:[this.tipsData.question.answer],optionValue:[this.tipsData.question.answers[this.tipsData.question.answer]],questionNum:this.tipsData.questionNum,returnValue:[""]}};this.loading=!0,(t=e,Object(d.a)({url:"ips/questionnaire/screening/appendQuestion/submit",method:"post",data:t})).then(function(t){i.loading=!1,200==t.code&&(i.dialogTips=!1,i.$toast("提交成功"),i.getPatientData())})},submitData:function(){var t=this;if(""!==this.problemData.question.answer){var i,e={questionnaireId:this.data.id,questionnaireNumber:this.data.number,medicalRecordId:this.medicalRecordId,patientId:this.patientId,questionResultList:[],questionnaireAnswer:{condition:this.data.condition,instruction:this.data.instruction,medicalRecordId:this.medicalRecordId,name:this.data.name,number:this.data.number,questionnaireId:this.data.id,type:this.data.type,userId:this.patientId,questions:[]}},s=!0,n=!1,u=void 0;try{for(var r,l=o()(this.data.questionList);!(s=(r=l.next()).done);s=!0){var c=r.value,h={},p={};"0"==c.type&&(h.displayOrder=c.displayOrder,h.optionOrderList=[c.question.answer],h.optionValue=[c.question.answers[c.question.answer]],h.questionNum=c.questionNum,h.remark="",h.returnValue=[""],p.answer=a()(c.question),p.medicalRecordId=this.medicalRecordId,p.questionNum=c.questionNum,p.questionnaireId=this.data.id,p.userId=this.patientId),e.questionResultList.push(h),e.questionnaireAnswer.questions.push(p)}}catch(t){n=!0,u=t}finally{try{!s&&l.return&&l.return()}finally{if(n)throw u}}this.loading=!0,(i=e,Object(d.a)({url:"ips/questionnaire/screening/submit",method:"post",data:i})).then(function(i){if(t.loading=!1,200==i.code)if(0!=i.dataList.length){var e=i.dataList[0];e.question=JSON.parse(e.question),t.tipsData=e,t.dialogTips=!0,t.$toast(i.message)}else t.getPatientData();else t.$toast(i.message)}).catch(function(i){t.loading=!1})}else this.$toast("请选择答案!")}}},m={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"app-container"},[e("van-nav-bar",{staticClass:"bar",attrs:{fixed:"",placeholder:"",title:"答题","left-text":"返回","left-arrow":""},on:{"click-left":t.onClickLeft}}),t._v(" "),e("div",{staticClass:"answer-box"},[e("div",{staticClass:"title"},[t._v(t._s(t.data.name))]),t._v(" "),e("div",{staticClass:"explain"},[t._v(t._s(t.data.instruction))]),t._v(" "),t.percentage?e("van-progress",{attrs:{percentage:t.percentage,format:t.formatPercentage}}):t._e(),t._v(" "),e("div",{staticClass:"explain"},[t._v(t._s(t.problemData.instruction))]),t._v(" "),t.problemData.question?e("div",{staticClass:"question"},[t._v("题目:"+t._s(t.problemData.question.question))]):t._e(),t._v(" "),e("div",[t.problemData.question?e("van-radio-group",{model:{value:t.problemData.question.answer,callback:function(i){t.$set(t.problemData.question,"answer",i)},expression:"problemData.question.answer"}},t._l(t.problemData.question.answers,function(i,s){return e("div",{key:s,staticClass:"question",on:{click:t.handleChange}},[e("van-radio",{attrs:{name:s}},[t._v(t._s(i))])],1)}),0):t._e()],1)],1),t._v(" "),e("div",{staticClass:"btn-box"},[e("van-button",{attrs:{type:"info",plain:""},on:{click:t.prevQuestion}},[t._v("上一题")]),t._v(" "),t.questionLength!=t.questionNum+1?e("van-button",{attrs:{type:"info",plain:""},on:{click:t.nextQuestion}},[t._v("下一题")]):e("van-button",{attrs:{type:"info",plain:""},on:{click:t.submitData}},[t._v("提交")])],1),t._v(" "),e("div",{staticClass:"btn-box"},[e("van-button",{attrs:{type:"info",plain:""},on:{click:t.finishCommit}},[t._v("完成并提交")])],1),t._v(" "),e("van-overlay",{attrs:{show:t.loading},on:{click:function(i){t.show=!1}}},[e("div",{staticClass:"wrapper"},[e("van-loading",{staticClass:"block",attrs:{size:"50px",vertical:"",type:"spinner"}},[t._v(" 加载中...")])],1)]),t._v(" "),e("van-dialog",{attrs:{title:"提示","show-cancel-button":""},on:{confirm:t.appendQuestionSubmitData},model:{value:t.dialogTips,callback:function(i){t.dialogTips=i},expression:"dialogTips"}},[t.tipsData.question?e("div",{staticClass:"tips-box"},[e("div",{staticClass:"title"},[t._v("问题:"+t._s(t.tipsData.question.question))]),t._v(" "),e("van-radio-group",{model:{value:t.tipsData.question.answer,callback:function(i){t.$set(t.tipsData.question,"answer",i)},expression:"tipsData.question.answer"}},t._l(t.tipsData.question.answers,function(i,s){return e("van-radio",{key:s,staticClass:"radio",attrs:{name:s}},[t._v(t._s(i))])}),1)],1):t._e()])],1)},staticRenderFns:[]};var q=e("VU/8")(p,m,!1,function(t){e("4erH")},"data-v-73b2ceb0",null);i.default=q.exports},"KFy/":function(t,i,e){"use strict";i.b=function(t){return Object(s.a)({url:"ips/medicalRecord",method:"put",data:t})},i.a=function(t){return Object(s.a)({url:"ips/medicalRecord/list/patient/"+t.pageNum+"/"+t.pageSize,method:"get",params:t})};var s=e("vLgD")},mvHQ:function(t,i,e){t.exports={default:e("qkKv"),__esModule:!0}},qkKv:function(t,i,e){var s=e("FeBl"),a=s.JSON||(s.JSON={stringify:JSON.stringify});t.exports=function(t){return a.stringify.apply(a,arguments)}}});
//# sourceMappingURL=2.36d1c65c1a4c4145aa90.js.map